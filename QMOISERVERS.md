# QMOI Servers Inventory and Deployment Guide

This document lists the servers (HTTP services) present in the repository, their purpose, recommended deployment options, and offline/self-contained deployment strategies.

## Servers found in repository

- `qmoi_control_server.py` (Flask) — central control server for PWAs, auth, WebAuthn, memory sync, attachments, admin actions, and mirror proxy.
  - Port (default): 8000
  - Key endpoints: `/control`, `/ai`, `/ai/tts`, `/signup`, `/login`, `/logout`, `/webauthn/*`, `/sync-memory`, `/memories`, `/attachments`, `/mirror/*`, `/admin/*`, `/ready`, `/metrics`, `/sponsored/*`
  - Deploy: WSGI/ASGI with Gunicorn + gevent or uWSGI for production; Dockerfile recommended.

- `ai-anomaly-service.py` (Flask) — anomaly detection and monitoring service.
  - Port (default): 5001
  - Key endpoints: `/detect-anomaly`, `/analytics`, `/export-analytics`

- FastAPI services (various):
  - `downloadqmoiaiexe.py` / `qmoiexe.py` / `qmoiaxe.py` — download / exe distribution endpoints, model serving stubs, and workspace services.
  - Various `scripts/*` contain FastAPI backends for automation, space backends, and APIs.
  - Deploy with Uvicorn (ASGI) behind a reverse proxy (Nginx) or in containers.

- Express/Node dashboards:
  - `dashboard/server.js`, `huggingface_space/server.js`, and several `scripts/*.js` include Express servers used for dashboards and demos.
  - Deploy with Node process managers (pm2), Docker, or systemd services.

## Offline deployment & self-contained bundle

To ensure QMOI runs when offline (no GitHub, no external networks):

1. Create an offline bundle (archive) that includes:
   - All Python servers and their dependencies pinned in `requirements.txt`.
   - Static PWAs under `pwa_apps/`.
   - `qmoi.db` initial state and migration scripts.
   - Scripts to start servers locally (`scripts/ensure_qmoi_servers.sh`).

2. Provide a `pack_offline_bundle.sh` script to build the archive and a `unpack_and_run.sh` script to restore and launch all services.

3. For attachments and large assets, include a local `object_storage/` folder and a simple HTTP file server to serve media when S3 is unavailable.

## Supervisor & always-on strategies

- Use `systemd` units or `supervisord` to keep services running after reboots or when the Codespace/terminal is closed.
- Provide Docker Compose and Kubernetes manifests for cluster deployments with health/readiness probes pointing to `/health` and `/ready`.
- For tunnel resilience (ngrok/alternatives): run a local tunneler that writes the live URL to `live_qmoi_ngrok_url.txt` and ensure `update_ngrok_links.py` uses that canonical file.

## Security

- Production must set `QMOI_JWT_SECRET` and `QMOI_CONTROL_TOKEN` environment variables to non-default values.
- Use HTTPS (TLS) with valid certificates; WebAuthn requires a valid RP ID (domain) and HTTPS.

## Next steps (recommendations)

- Add `Dockerfile.qmoi_control` and `docker-compose.yml` to orchestrate services.
- Add `pack_offline_bundle.sh` to generate a self-contained archive.
- Add systemd service examples and GitHub Actions to test startup.
- Implement object storage fallback and signed URL generation for attachments.

***

Generated by automation on 2025-10-23.
