#!/usr/bin/env sh
# Husky pre-push hook (PowerShell compatible)

# Check if fix:all script exists
if npm run | grep -q 'fix:all'; then
  echo "[Husky] Running fix:all..."
  npm run fix:all || echo "[Husky] Warning: fix:all failed, but continuing (PowerShell safe)"
else
  echo "[Husky] Warning: fix:all script not found, skipping."
fi

# Run QMOI Always Fix All before push, exit on failure
echo "[Husky] Running qmoi:always-fix-all..."
npm run qmoi:always-fix-all || {
  echo "[Husky] Error: qmoi:always-fix-all failed. Aborting push."
  exit 1
}

# Run QMOI pre-activity check, exit on failure
echo "[Husky] Running pre-activity check..."
node scripts/qmoi_pre_activity_check.js || {
  echo "[Husky] Error: QMOI pre-activity check failed. Aborting push."
  exit 1
}

# Run tests
echo "[Husky] Running tests..."
npm test || {
  echo "[Husky] Error: Tests failed. Aborting push."
  exit 1
}
