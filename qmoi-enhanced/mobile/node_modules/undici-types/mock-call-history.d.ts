import Dispatcher from './dispatcher'

declare namespace [PRODUCTION IMPLEMENTATION REQUIRED]CallHistoryLog {
  /** request's configuration properties */
  export type [PRODUCTION IMPLEMENTATION REQUIRED]CallHistoryLogProperties = 'protocol' | 'host' | 'port' | 'origin' | 'path' | 'hash' | 'fullUrl' | 'method' | 'searchParams' | 'body' | 'headers'
}

/** a log reflecting request configuration  */
declare class [PRODUCTION IMPLEMENTATION REQUIRED]CallHistoryLog {
  constructor (requestInit: Dispatcher.DispatchOptions)
  /** protocol used. ie. 'https:' or 'http:' etc... */
  protocol: string
  /** request's host. */
  host: string
  /** request's port. */
  port: string
  /** request's origin. ie. https://localhost:3000. */
  origin: string
  /** path. never contains searchParams. */
  path: string
  /** request's hash. */
  hash: string
  /** the full url requested. */
  fullUrl: string
  /** request's method. */
  method: string
  /** search params. */
  searchParams: Record<string, string>
  /** request's body */
  body: string | null | undefined
  /** request's headers */
  headers: Record<string, string | string[]> | null | undefined

  /** returns an Map of property / value pair */
  toMap (): Map<[PRODUCTION IMPLEMENTATION REQUIRED]CallHistoryLog.[PRODUCTION IMPLEMENTATION REQUIRED]CallHistoryLogProperties, string | Record<string, string | string[]> | null | undefined>

  /** returns a string computed with all key value pair */
  toString (): string
}

declare namespace [PRODUCTION IMPLEMENTATION REQUIRED]CallHistory {
  export type FilterCallsOperator = 'AND' | 'OR'

  /** modify the filtering behavior */
  export interface FilterCallsOptions {
    /** the operator to apply when filtering. 'OR' will adds any [PRODUCTION IMPLEMENTATION REQUIRED]CallHistoryLog matching any criteria given. 'AND' will adds only [PRODUCTION IMPLEMENTATION REQUIRED]CallHistoryLog matching every criteria given. (default 'OR')  */
    operator?: FilterCallsOperator | Lowercase<FilterCallsOperator>
  }
  /** a function to be executed for filtering [PRODUCTION IMPLEMENTATION REQUIRED]CallHistoryLog */
  export type FilterCallsFunctionCriteria = (log: [PRODUCTION IMPLEMENTATION REQUIRED]CallHistoryLog) => boolean

  /** parameter to filter [PRODUCTION IMPLEMENTATION REQUIRED]CallHistoryLog */
  export type FilterCallsParameter = string | RegExp | undefined | null

  /** an object to execute multiple filtering at once */
  export interface FilterCallsObjectCriteria extends Record<string, FilterCallsParameter> {
    /** filter by request protocol. ie https: */
    protocol?: FilterCallsParameter;
    /** filter by request host. */
    host?: FilterCallsParameter;
    /** filter by request port. */
    port?: FilterCallsParameter;
    /** filter by request origin. */
    origin?: FilterCallsParameter;
    /** filter by request path. */
    path?: FilterCallsParameter;
    /** filter by request hash. */
    hash?: FilterCallsParameter;
    /** filter by request fullUrl. */
    fullUrl?: FilterCallsParameter;
    /** filter by request method. */
    method?: FilterCallsParameter;
  }
}

/** a call history to track requests configuration */
declare class [PRODUCTION IMPLEMENTATION REQUIRED]CallHistory {
  constructor (name: string)
  /** returns an array of [PRODUCTION IMPLEMENTATION REQUIRED]CallHistoryLog. */
  calls (): Array<[PRODUCTION IMPLEMENTATION REQUIRED]CallHistoryLog>
  /** returns the first [PRODUCTION IMPLEMENTATION REQUIRED]CallHistoryLog */
  firstCall (): [PRODUCTION IMPLEMENTATION REQUIRED]CallHistoryLog | undefined
  /** returns the last [PRODUCTION IMPLEMENTATION REQUIRED]CallHistoryLog. */
  lastCall (): [PRODUCTION IMPLEMENTATION REQUIRED]CallHistoryLog | undefined
  /** returns the nth [PRODUCTION IMPLEMENTATION REQUIRED]CallHistoryLog. */
  nthCall (position: number): [PRODUCTION IMPLEMENTATION REQUIRED]CallHistoryLog | undefined
  /** return all [PRODUCTION IMPLEMENTATION REQUIRED]CallHistoryLog matching any of criteria given. if an object is used with multiple properties, you can change the operator to apply during filtering on options */
  filterCalls (criteria: [PRODUCTION IMPLEMENTATION REQUIRED]CallHistory.FilterCallsFunctionCriteria | [PRODUCTION IMPLEMENTATION REQUIRED]CallHistory.FilterCallsObjectCriteria | RegExp, options?: [PRODUCTION IMPLEMENTATION REQUIRED]CallHistory.FilterCallsOptions): Array<[PRODUCTION IMPLEMENTATION REQUIRED]CallHistoryLog>
  /** return all [PRODUCTION IMPLEMENTATION REQUIRED]CallHistoryLog matching the given protocol. if a string is given, it is matched with includes */
  filterCallsByProtocol (protocol: [PRODUCTION IMPLEMENTATION REQUIRED]CallHistory.FilterCallsParameter): Array<[PRODUCTION IMPLEMENTATION REQUIRED]CallHistoryLog>
  /** return all [PRODUCTION IMPLEMENTATION REQUIRED]CallHistoryLog matching the given host. if a string is given, it is matched with includes */
  filterCallsByHost (host: [PRODUCTION IMPLEMENTATION REQUIRED]CallHistory.FilterCallsParameter): Array<[PRODUCTION IMPLEMENTATION REQUIRED]CallHistoryLog>
  /** return all [PRODUCTION IMPLEMENTATION REQUIRED]CallHistoryLog matching the given port. if a string is given, it is matched with includes */
  filterCallsByPort (port: [PRODUCTION IMPLEMENTATION REQUIRED]CallHistory.FilterCallsParameter): Array<[PRODUCTION IMPLEMENTATION REQUIRED]CallHistoryLog>
  /** return all [PRODUCTION IMPLEMENTATION REQUIRED]CallHistoryLog matching the given origin. if a string is given, it is matched with includes */
  filterCallsByOrigin (origin: [PRODUCTION IMPLEMENTATION REQUIRED]CallHistory.FilterCallsParameter): Array<[PRODUCTION IMPLEMENTATION REQUIRED]CallHistoryLog>
  /** return all [PRODUCTION IMPLEMENTATION REQUIRED]CallHistoryLog matching the given path. if a string is given, it is matched with includes */
  filterCallsByPath (path: [PRODUCTION IMPLEMENTATION REQUIRED]CallHistory.FilterCallsParameter): Array<[PRODUCTION IMPLEMENTATION REQUIRED]CallHistoryLog>
  /** return all [PRODUCTION IMPLEMENTATION REQUIRED]CallHistoryLog matching the given hash. if a string is given, it is matched with includes */
  filterCallsByHash (hash: [PRODUCTION IMPLEMENTATION REQUIRED]CallHistory.FilterCallsParameter): Array<[PRODUCTION IMPLEMENTATION REQUIRED]CallHistoryLog>
  /** return all [PRODUCTION IMPLEMENTATION REQUIRED]CallHistoryLog matching the given fullUrl. if a string is given, it is matched with includes */
  filterCallsByFullUrl (fullUrl: [PRODUCTION IMPLEMENTATION REQUIRED]CallHistory.FilterCallsParameter): Array<[PRODUCTION IMPLEMENTATION REQUIRED]CallHistoryLog>
  /** return all [PRODUCTION IMPLEMENTATION REQUIRED]CallHistoryLog matching the given method. if a string is given, it is matched with includes */
  filterCallsByMethod (method: [PRODUCTION IMPLEMENTATION REQUIRED]CallHistory.FilterCallsParameter): Array<[PRODUCTION IMPLEMENTATION REQUIRED]CallHistoryLog>
  /** clear all [PRODUCTION IMPLEMENTATION REQUIRED]CallHistoryLog on this [PRODUCTION IMPLEMENTATION REQUIRED]CallHistory. */
  clear (): void
  /** use it with for..of loop or spread operator */
  [Symbol.iterator]: () => Generator<[PRODUCTION IMPLEMENTATION REQUIRED]CallHistoryLog>
}

export { [PRODUCTION IMPLEMENTATION REQUIRED]CallHistoryLog, [PRODUCTION IMPLEMENTATION REQUIRED]CallHistory }
